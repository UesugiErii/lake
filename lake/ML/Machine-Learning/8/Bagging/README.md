refer: [Bagging与随机森林算法原理小结](https://www.cnblogs.com/pinard/p/6156009.html), [scikit-learn随机森林调参小结](https://www.cnblogs.com/pinard/p/6160412.html)

## Bagging(8.3.1)

输入为样本集D={(x,y1),(x2,y2),...(xm,ym)}，弱学习器算法, 弱分类器迭代次数T。

输出为最终的强分类器f(x)

1. 对于t=1,2...,T:

    a)对训练集进行第t次随机放回采样，共采集m次，得到包含m个样本的采样集Dt

    b)用采样集Dt训练第t个弱学习器Gt(x)

2. 如果是分类算法预测，则T个弱学习器投出最多票数的类别或者类别之一为最终类别。如果是回归算法，T个弱学习器得到的回归结果进行算术平均得到的值为最终的模型输出。

## 随机森林(Random Forest)(8.3.2)

输入为样本集D={(x,y1),(x2,y2),...(xm,ym)}，弱分类器迭代次数T。

输出为最终的强分类器f(x)

1. 对于t=1,2...,T:

    a)对训练集进行第t次随机放回采样，共采集m次，得到包含m个样本的采样集Dt

    b)用采样集Dt训练第t个决策树模型Gt(x)，在训练决策树模型的节点的时候， 在每个节点上从所有的样本特征中选择一部分样本特征， 在这些随机选择的部分样本特征中选择一个最优的特征来做决策树的左右子树划分(每个节点随机选择的子特征集不一样, 建议子特征集大小为`k=log2(d)`)

2. 如果是分类算法预测，则T个弱学习器投出最多票数的类别或者类别之一为最终类别。如果是回归算法，T个弱学习器得到的回归结果进行算术平均得到的值为最终的模型输出。

## 随机森林变种

### extra trees

区别:

1. 每个决策树采用原始训练集

2. 随机的选择一个特征值来划分决策树(导致方差↓, 偏差↑)

### Totally Random Trees Embedding

Totally Random Trees Embedding(简称 TRTE)是一种非监督学习的数据转化方法。它将低维的数据集映射到高维，从而让映射到高维的数据更好的运用于分类回归模型。在支持向量机中运用了核方法来将低维的数据集映射到高维，此处TRTE提供了另外一种方法。

TRTE在数据转化的过程也使用了类似于RF的方法，建立T个决策树来拟合数据。当决策树建立完毕以后，数据集里的每个数据在T个决策树中叶子节点的位置也定下来了。比如我们有3颗决策树，每个决策树有5个叶子节点，某个数据特征x划分到第一个决策树的第2个叶子节点，第二个决策树的第3个叶子节点，第三个决策树的第5个叶子节点。则x映射后的特征编码为`(0,1,0,0,0,     0,0,1,0,0,     0,0,0,0,1)`, 有15维的高维特征。这里特征维度之间加上空格是为了强调三颗决策树各自的子编码。

映射到高维特征后，可以继续使用监督学习的各种分类回归算法了

### Isolation Forest

Isolation Forest（简称IForest）是一种异常点检测的方法

对于在T个决策树的样本集，IForest也会对训练集进行随机采样,但是采样个数不需要和RF一样，对于RF，需要采样到采样集样本个数等于训练集个数。但是IForest不需要采样这么多，一般来说，采样个数要远远小于训练集个数？为什么呢？因为我们的目的是异常点检测，只需要部分的样本我们一般就可以将异常点区别出来了。

对于每一个决策树的建立， IForest采用随机选择一个划分特征，对划分特征随机选择一个划分阈值。这点也和RF不同。

另外，IForest一般会选择一个比较小的最大决策树深度max_depth,原因同样本采集，用少量的异常点检测一般不需要这么大规模的决策树。

对于异常点的判断，则是将测试样本点x拟合到T颗决策树。计算在每颗决策树上该样本的叶子节点的深度ht(x)。，从而可以计算出平均高度h(x)。此时我们用下面的公式计算样本点x的异常概率:

$s(x,m) = 2^{-\frac{h(x)}{c(m)}}$

其中，m为样本个数。c(m)的表达式为：

$c(m) =2\ln(m-1) + \xi - 2\frac{m-1}{m}, \; \xi为欧拉常数$

s(x,m)的取值范围是\[0,1\],取值越接近于1，则是异常点的概率也越大

## 随机森林优缺点

### 优点

1. 训练可以高度并行化

2. 因为随机选择决策树节点划分特征，这样在样本特征维度很高的时候，仍然能高效的训练模型

3. 在训练后，可以给出各个特征对于输出的重要性

4. 由于采用了随机采样，训练出的模型的方差小，泛化能力强

5. 相对于Boosting系列的Adaboost和GBDT， RF实现比较简单

6. 对部分特征缺失不敏感

### 缺点

1. 在某些噪音比较大的样本集上，RF模型容易陷入过拟合

2. 取值划分比较多的特征容易对RF的决策产生更大的影响，从而影响拟合的模型的效果